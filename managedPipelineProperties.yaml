type: maven
integrationBranches:
  - master
  - mp
pipelineAdministrators:
  - 854495
  - 243211
env:
  variables:
    # Default SonarQube project name w/o overwriting them below: managed-pipeline.receipts-ms-project
    # SONARQUBE_PROJECT_KEY: tr.receipts-ms
    # SONARQUBE_PROJECT_NAME: tr.receipts-ms

container:
  image: packages.aa.com/docker-prod/edots-base:3.11.12

notifications:
  onlyOnIntegration: true

CI:
  coverity:
    APP_NAME: receipts-ms
    CONFIG: ['java']
  xray:
    reporting: true

  #post:
  #  - name: 'step name'
  #    steps: |
  #      sh 'command'
  #  - name: 'other step name'
  #    stepsFile: fileName.groovy

provider:
  azure:
    servicePrincipalCredJenkins: ct-np-receipts-as-server-sp
    subscription: aa-ct-nonprod-spoke
    azurerm:
      resource_group_name: tfstate
      storage_account_name: bttfstate
      container_name: delextfstate

deployApp: appservice
publishPath: target

CD:
  #cherwell:
    #archerAppName: 'Receipts'
    #cherwellTeamName: 'Fly - Ancillaries Receipts'

  deployments:
    dev:
      servicePrincipalCredJenkins: ct-np-receipts-as-server-sp
      subscription: aa-ct-nonprod-spoke
      app:
        - name: 'receipts-ms-dev'
          resourceGroup: 'ct-n-zeaus-receipts-rg'
          region: 'East US'
      sourceBranches:
        - mp # Consider adding develop branch to the repo and change this to develop so only develop and master will deploy
        - master

      actions:
      #  - name: 'Pre-deployment action'
      #    action: '...' ## Like pre build
      #  - name: 'azure deployment'
      #    action: 'azuredeploy'
        - name: 'Post-deployment action'
          action: 'mvn -P azure-dev azure-webapp:deploy' ## Run Mvn deployment

    #prod:
      #servicePrincipalCredJenkins: ct-p-receipts-as-server-sp
      #subscription: aa-ct-prod-spoke
      #app:
        #- name: receipts-ms
          #region       : 'East US'
          #resourceGroup: ct-p-zeaus-receipts-rg 
          ## slot: 'Staging' ##Optional to deploy to Production/Staging slot

          #actions:
          #  - name: 'Post-deployment action'
          #    action: 'mvn -P azure-prod-east azure-webapp:deploy' ## Run Mvn deployment

        #- name: receipts-ms
          #region       : 'West US'
          ## slot: 'Staging' ##Optional to deploy to Production/Staging slot
          #resourceGroup: ct-p-zweus-receipts-rg 
      #sourceBranches:
        #- master
