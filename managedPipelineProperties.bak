type: maven
integrationBranches:
  - master
pipelineAdministrators:
  - 854495
  - 243211
env:
  variables:
    # Default SonarQube project name w/o overwriting them below: managed-pipeline.receipts-ms-project
    # SONARQUBE_PROJECT_KEY: tr.receipts-ms
    # SONARQUBE_PROJECT_NAME: tr.receipts-ms

notifications:
  onlyOnIntegration: false
  emails:
    - DL_Ticketing_Intrepid@aa.com
  slack:
    channel: ticketing-intrepid
    creds: ticketing-intrepid-slack-token

#provider:
#  azure:
#    servicePrincipalCredJenkins: <Azure service principal credential variable name in Jenkins>

deployInfra: yamlit_terraform
deployApp: appservice
#publishPath: <artifact path> # Files under this path will be published to the Artifactory and deployed to Azure

CI:
  pre:
    - name: 'Integration Tests'
      steps: |
        sh 'mvn verify -DappName=$CF_APP_NAME -DappDomain=$CF_DOMAIN -DreqProxy="true" -Pintegration-tests -Djacoco.outputDir=./devops/maven'

  coverity:
    CONFIG: ['java']
  xray:
    reporting: true
    
  post:
    - name: 'Integration Tests'
      steps: |
        sh 'mvn verify -DappName=$CF_APP_NAME -DappDomain=$CF_DOMAIN -DreqProxy="true" -Pintegration-tests -Djacoco.outputDir=./devops/maven'

CD:
  cherwell:
    archerAppName: 'Receipts'
    cherwellTeamName: 'Fly - Ancillaries Receipts'
  deployments:
    dev:
      app:
        - name: receipts-ms-dev
          resourceGroup: ct-n-zeaus-receipts-rg 
      sourceBranches:
        - master
      subscription: aa-ct-nonprod-spoke
    #stage:
      #app:
        #- name: receipts-ms-dev
          #region       : east
          #resourceGroup: ct-n-zeaus-receipts-rg 
        #- name: receipts-ms-dev
          #region       : south
          #resourceGroup: ct-n-zeaus-receipts-rg 
      #sourceBranches:
        #- master
      #subscription: aa-ct-nonprod-spoke
      
      actions:
        - name: 'Print directory'
          steps: |
            sh 'ls'
        - name: 'Rename jar'
          steps: |
            sh 'mv resagent-sell*.jar resagent-sell.jar'        
        - name: 'CUPS Primary'
          action: 'cfCUPS'
          region:
            south:
             CF_CUPS_ID: 'RESAGENT_SELL_MEALS_CUPS_SECRET_FILE_STAGE'
        - name: 'Deployment Primary'
          stepsFile: 'bluegreen_dr.groovy'
        - name: 'CUPS Secondary'
          action: 'cfCUPS'
          region:
            east:
             CF_API_URL: 'https://api.us-east.bluemix.net'
             CF_CUPS_ID: 'RESAGENT_SELL_MEALS_CUPS_SECRET_FILE_STAGEDR'
        - name: 'Deployment Secondary'
          stepsFile: 'bluegreen_dr.groovy'
      